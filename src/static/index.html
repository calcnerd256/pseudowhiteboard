<html>
 <head>
  <title>Pseudowhiteboard</title>
  <script src="./ajax.js"></script>
  <script>
   function promiseSendMessage(message){
    var payload = "message=" + message.split(" ").map(
     encodeURIComponent
    ).join("+");
    return promiseRequest("POST", "/chatopsdb", "message=" + message)
   }
   function promiseReadChatroom(){
    return promiseGET("/chatopsdb").then(
     function(db){
      return db.split("\n").map(
       function(line){
        var pieces = line.split(": ");
        var usrid = pieces.shift();
        return [usrid, pieces.join(": ")];
       }
      );
     }
    );
   }
   function hello(){
    return promiseSendMessage("Hello.").then(
     function(msgid){
      return promiseReadChatroom().then(
       function(db){
        return db[+msgid][0];
       }
      )
     }
    );
   }
/*
* /
   hello().then(
    console.log.bind(console, "good"),
    console.log.bind(console, "bad")
   );
// */
  </script>
 </head>
 <body>
  <p>This page is where the mobile client will be.</p>
  <form action="/chatopsdb/" method="POST">
   chat
   <input type="text" name="message"></input>
   <input type="submit"></input>
  </form>
 </body>
</html>
